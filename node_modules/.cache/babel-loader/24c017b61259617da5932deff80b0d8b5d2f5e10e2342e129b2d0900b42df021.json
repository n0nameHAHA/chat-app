{"ast":null,"code":"import _defineProperty from\"/Users/admin/Downloads/2023 projects/chat-app/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _regeneratorRuntime from\"/Users/admin/Downloads/2023 projects/chat-app/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/admin/Downloads/2023 projects/chat-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/admin/Downloads/2023 projects/chat-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useContext,useState}from'react';import Img from'../img/img.png';import Attach from'../img/attach.png';import{AuthContext}from'../context/AuthContext';import{ChatContext}from'../context/ChatContext';import{arrayUnion,doc,serverTimestamp,Timestamp,updateDoc}from'firebase/firestore';import{db,storage}from'../firebase';import{v4 as uuid}from'uuid';import{getDownloadURL,ref,uploadBytesResumable}from'firebase/storage';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Input=function Input(){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),text=_useState2[0],setText=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),img=_useState4[0],setImg=_useState4[1];var _useContext=useContext(AuthContext),currentUser=_useContext.currentUser;var _useContext2=useContext(ChatContext),data=_useContext2.data;var handleSend=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var _updateDoc,_updateDoc2;var storageRef,uploadTask;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if(!img){_context2.next=6;break;}storageRef=ref(storage,uuid());uploadTask=uploadBytesResumable(storageRef,img);uploadTask.on(function(error){//TODO:Handle Error\n},function(){getDownloadURL(uploadTask.snapshot.ref).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(downloadURL){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return updateDoc(doc(db,'chats',data.chatId),{messages:arrayUnion({id:uuid(),text:text,senderId:currentUser.uid,date:Timestamp.now(),img:downloadURL})});case 2:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}());});_context2.next=8;break;case 6:_context2.next=8;return updateDoc(doc(db,'chats',data.chatId),{messages:arrayUnion({id:uuid(),text:text,senderId:currentUser.uid,date:Timestamp.now()})});case 8:_context2.next=10;return updateDoc(doc(db,'userChats',currentUser.uid),(_updateDoc={},_defineProperty(_updateDoc,data.chatId+'.lastMessage',{text:text}),_defineProperty(_updateDoc,data.chatId+'.date',serverTimestamp()),_updateDoc));case 10:_context2.next=12;return updateDoc(doc(db,'userChats',data.user.uid),(_updateDoc2={},_defineProperty(_updateDoc2,data.chatId+'.lastMessage',{text:text}),_defineProperty(_updateDoc2,data.chatId+'.date',serverTimestamp()),_updateDoc2));case 12:setText('');setImg(null);case 14:case\"end\":return _context2.stop();}},_callee2);}));return function handleSend(){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"input\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Type something...\",onChange:function onChange(e){return setText(e.target.value);},value:text}),/*#__PURE__*/_jsxs(\"div\",{className:\"send\",children:[/*#__PURE__*/_jsx(\"img\",{src:Attach,alt:\"\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",style:{display:'none'},id:\"file\",onChange:function onChange(e){return setImg(e.target.files[0]);}}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"file\",children:/*#__PURE__*/_jsx(\"img\",{src:Img,alt:\"\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSend,children:\"Send\"})]})]});};export default Input;","map":{"version":3,"names":["React","useContext","useState","Img","Attach","AuthContext","ChatContext","arrayUnion","doc","serverTimestamp","Timestamp","updateDoc","db","storage","v4","uuid","getDownloadURL","ref","uploadBytesResumable","jsx","_jsx","jsxs","_jsxs","Input","_useState","_useState2","_slicedToArray","text","setText","_useState3","_useState4","img","setImg","_useContext","currentUser","_useContext2","data","handleSend","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","_updateDoc","_updateDoc2","storageRef","uploadTask","wrap","_callee2$","_context2","prev","next","on","error","snapshot","then","_ref2","_callee","downloadURL","_callee$","_context","chatId","messages","id","senderId","uid","date","now","stop","_x","apply","arguments","_defineProperty","user","className","children","type","placeholder","onChange","e","target","value","src","alt","style","display","files","htmlFor","onClick"],"sources":["/Users/admin/Downloads/2023 projects/chat-app/src/components/Input.jsx"],"sourcesContent":["import React, { useContext, useState } from 'react';\nimport Img from '../img/img.png';\nimport Attach from '../img/attach.png';\nimport { AuthContext } from '../context/AuthContext';\nimport { ChatContext } from '../context/ChatContext';\nimport { arrayUnion, doc, serverTimestamp, Timestamp, updateDoc } from 'firebase/firestore';\nimport { db, storage } from '../firebase';\nimport { v4 as uuid } from 'uuid';\nimport { getDownloadURL, ref, uploadBytesResumable } from 'firebase/storage';\n\nconst Input = () => {\n  const [text, setText] = useState('');\n  const [img, setImg] = useState(null);\n\n  const { currentUser } = useContext(AuthContext);\n  const { data } = useContext(ChatContext);\n\n  const handleSend = async () => {\n    if (img) {\n      const storageRef = ref(storage, uuid());\n\n      const uploadTask = uploadBytesResumable(storageRef, img);\n\n      uploadTask.on(\n        (error) => {\n          //TODO:Handle Error\n        },\n        () => {\n          getDownloadURL(uploadTask.snapshot.ref).then(async (downloadURL) => {\n            await updateDoc(doc(db, 'chats', data.chatId), {\n              messages: arrayUnion({\n                id: uuid(),\n                text,\n                senderId: currentUser.uid,\n                date: Timestamp.now(),\n                img: downloadURL,\n              }),\n            });\n          });\n        },\n      );\n    } else {\n      await updateDoc(doc(db, 'chats', data.chatId), {\n        messages: arrayUnion({\n          id: uuid(),\n          text,\n          senderId: currentUser.uid,\n          date: Timestamp.now(),\n        }),\n      });\n    }\n\n    await updateDoc(doc(db, 'userChats', currentUser.uid), {\n      [data.chatId + '.lastMessage']: {\n        text,\n      },\n      [data.chatId + '.date']: serverTimestamp(),\n    });\n\n    await updateDoc(doc(db, 'userChats', data.user.uid), {\n      [data.chatId + '.lastMessage']: {\n        text,\n      },\n      [data.chatId + '.date']: serverTimestamp(),\n    });\n\n    setText('');\n    setImg(null);\n  };\n  return (\n    <div className=\"input\">\n      <input\n        type=\"text\"\n        placeholder=\"Type something...\"\n        onChange={(e) => setText(e.target.value)}\n        value={text}\n      />\n      <div className=\"send\">\n        <img src={Attach} alt=\"\" />\n        <input\n          type=\"file\"\n          style={{ display: 'none' }}\n          id=\"file\"\n          onChange={(e) => setImg(e.target.files[0])}\n        />\n        <label htmlFor=\"file\">\n          <img src={Img} alt=\"\" />\n        </label>\n        <button onClick={handleSend}>Send</button>\n      </div>\n    </div>\n  );\n};\n\nexport default Input;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}